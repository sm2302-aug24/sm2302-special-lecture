<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.550">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>SM-2302 Special Lectures - Quantitative analysis of textual data</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
/* CSS for citations */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
  margin-bottom: 0em;
}
.hanging-indent div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="site_libs/quarto-diagram/mermaid.min.js"></script>
<script src="site_libs/quarto-diagram/mermaid-init.js"></script>
<link href="site_libs/quarto-diagram/mermaid.css" rel="stylesheet">

  <script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml-full.js" type="text/javascript"></script>

<script type="text/javascript">
const typesetMath = (el) => {
  if (window.MathJax) {
    // MathJax Typeset
    window.MathJax.typeset([el]);
  } else if (window.katex) {
    // KaTeX Render
    var mathElements = el.getElementsByClassName("math");
    var macros = [];
    for (var i = 0; i < mathElements.length; i++) {
      var texText = mathElements[i].firstChild;
      if (mathElements[i].tagName == "SPAN") {
        window.katex.render(texText.data, mathElements[i], {
          displayMode: mathElements[i].classList.contains('display'),
          throwOnError: false,
          macros: macros,
          fleqn: false
        });
      }
    }
  }
}
window.Quarto = {
  typesetMath
};
</script>

<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg " data-bs-theme="dark">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container mx-auto">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">SM-2302 Special Lectures</span>
    </a>
  </div>
            <div id="quarto-search" class="" title="Search"></div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item">
    <a class="nav-link" href="./index.html"> 
<span class="menu-text">Home</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./1-scraping_linear_reg.html"> 
<span class="menu-text">Scraping and linear regression</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="./2-gis_data.html"> 
<span class="menu-text">Spatial data analysis</span></a>
  </li>  
  <li class="nav-item">
    <a class="nav-link active" href="./3-quanteda.html" aria-current="page"> 
<span class="menu-text">Quantitative text analysis</span></a>
  </li>  
</ul>
          </div> <!-- /navcollapse -->
          <div class="quarto-navbar-tools">
</div>
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction">Introduction</a></li>
  <li><a href="#quantitative-data" id="toc-quantitative-data" class="nav-link" data-scroll-target="#quantitative-data">Quantitative data</a>
  <ul class="collapse">
  <li><a href="#pre-formatted-files" id="toc-pre-formatted-files" class="nav-link" data-scroll-target="#pre-formatted-files">Pre-formatted files</a></li>
  <li><a href="#multiple-text-files" id="toc-multiple-text-files" class="nav-link" data-scroll-target="#multiple-text-files">Multiple text files</a></li>
  <li><a href="#json" id="toc-json" class="nav-link" data-scroll-target="#json">JSON</a></li>
  <li><a href="#pdf" id="toc-pdf" class="nav-link" data-scroll-target="#pdf">PDF</a></li>
  <li><a href="#microsoft-word" id="toc-microsoft-word" class="nav-link" data-scroll-target="#microsoft-word">Microsoft Word</a></li>
  </ul></li>
  <li><a href="#workflow" id="toc-workflow" class="nav-link" data-scroll-target="#workflow">Workflow</a>
  <ul class="collapse">
  <li><a href="#corpus" id="toc-corpus" class="nav-link" data-scroll-target="#corpus">Corpus</a></li>
  <li><a href="#tokens" id="toc-tokens" class="nav-link" data-scroll-target="#tokens">Tokens</a></li>
  <li><a href="#document-feature-matrix" id="toc-document-feature-matrix" class="nav-link" data-scroll-target="#document-feature-matrix">Document feature matrix</a></li>
  </ul></li>
  <li><a href="#statistical-analysis" id="toc-statistical-analysis" class="nav-link" data-scroll-target="#statistical-analysis">Statistical analysis</a>
  <ul class="collapse">
  <li><a href="#simple-frequency-analysis" id="toc-simple-frequency-analysis" class="nav-link" data-scroll-target="#simple-frequency-analysis">Simple frequency analysis</a></li>
  <li><a href="#lexical-diversity" id="toc-lexical-diversity" class="nav-link" data-scroll-target="#lexical-diversity">Lexical diversity</a></li>
  <li><a href="#documentfeature-similarity" id="toc-documentfeature-similarity" class="nav-link" data-scroll-target="#documentfeature-similarity">Document/Feature similarity</a></li>
  <li><a href="#feature-co-occurence-matrix" id="toc-feature-co-occurence-matrix" class="nav-link" data-scroll-target="#feature-co-occurence-matrix">Feature co-occurence matrix</a></li>
  </ul></li>
  <li><a href="#scaling-and-classification" id="toc-scaling-and-classification" class="nav-link" data-scroll-target="#scaling-and-classification">Scaling and classification</a>
  <ul class="collapse">
  <li><a href="#wordfish" id="toc-wordfish" class="nav-link" data-scroll-target="#wordfish">Wordfish</a></li>
  <li><a href="#topic-models" id="toc-topic-models" class="nav-link" data-scroll-target="#topic-models">Topic models</a></li>
  <li><a href="#latent-semantic-scaling" id="toc-latent-semantic-scaling" class="nav-link" data-scroll-target="#latent-semantic-scaling">Latent semantic scaling</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Quantitative analysis of textual data</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  


</header>


<ul>
<li>https://tutorials.quanteda.io/introduction/</li>
</ul>
<section id="introduction" class="level2">
<h2 class="anchored" data-anchor-id="introduction">Introduction</h2>
<p>There are several R packages used for quantitative text analysis, but we will focus specifically on the <code>{quanteda}</code> package. So, first install the package from CRAN:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quanteda"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Since the release of <code>{quanteda}</code> version 3.0, <code>textstat_*</code>, <code>textmodel_*</code> and <code>textplot_*</code> functions are available in separate packages. We will use several of these functions in the chapters below and strongly recommend installing these packages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quanteda.textmodels"</span>)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quanteda.textstats"</span>)</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"quanteda.textplots"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We will use the <code>{readtext}</code> package to read in different types of text data in these tutorials.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">"readtext"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="quantitative-data" class="level2">
<h2 class="anchored" data-anchor-id="quantitative-data">Quantitative data</h2>
<p>Before beginning we need to load the libraries</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda)</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textmodels)</span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textstats)</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(quanteda.textplots)</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(readtext)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>And these ones lates for the modelling section:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seededlda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Warning: package 'seededlda' was built under R version 4.4.1</code></pre>
</div>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(LSX)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdendro)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="pre-formatted-files" class="level3">
<h3 class="anchored" data-anchor-id="pre-formatted-files">Pre-formatted files</h3>
<p>If your text data is stored in a pre-formatted file where one column contains the text and additional columns might store document-level variables (e.g.&nbsp;year, author, or language), you can import this into R using <code>read_csv()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>path_data <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/"</span>, <span class="at">package =</span> <span class="st">"readtext"</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>dat_inaug <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">paste0</span>(path_data, <span class="st">"/csv/inaugCorpus.csv"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stderr">
<pre><code>Rows: 5 Columns: 4
── Column specification ────────────────────────────────────────────────────────
Delimiter: ","
chr (3): texts, President, FirstName
dbl (1): Year

ℹ Use `spec()` to retrieve the full column specification for this data.
ℹ Specify the column types or set `show_col_types = FALSE` to quiet this message.</code></pre>
</div>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat_inaug)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 5
Columns: 4
$ texts     &lt;chr&gt; "Fellow-Citizens of the Senate and of the House of Represent…
$ Year      &lt;dbl&gt; 1789, 1793, 1797, 1801, 1805
$ President &lt;chr&gt; "Washington", "Washington", "Adams", "Jefferson", "Jefferson"
$ FirstName &lt;chr&gt; "George", "George", "John", "Thomas", "Thomas"</code></pre>
</div>
</div>
<p>The data set is about the inaugural speeches of the US presidents. So as we can see the data set is arranged in tabular form, with 5 rows and 4 columns. The columns are <code>texts</code>, <code>Year</code>, <code>President</code>, and <code>FirstName</code>.</p>
<p>Alternatively, you can use the <code>{readtext}</code> package to import character (comma- or tab-separated) values. <code>{readtext}</code> reads files containing text, along with any associated document-level variables. As an example, consider the following tsv file:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>tsv_file <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path_data, <span class="st">"/tsv/dailsample.tsv"</span>)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(tsv_file, <span class="at">n =</span> <span class="dv">4</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)  <span class="co"># first 3 lines</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>speechID    memberID    partyID constID title   date    member_name party_name  const_name  speech
1   977 22  158 1. CEANN COMHAIRLE I gCOIR AN LAE.  1919-01-21  Count George Noble, Count Plunkett  Sinn Féin   Roscommon North Molaimse don Dáil Cathal Brugha, an Teachta ó Dhéisibh Phortláirge do bheith mar Cheann Comhairle againn indiu.
2   1603    22  103 1. CEANN COMHAIRLE I gCOIR AN LAE.  1919-01-21  Mr. Pádraic Ó Máille    Sinn Féin   Galway Connemara    Is bród mór damhsa cur leis an dtairgsin sin. Air sin do ghaibh CATHAL BRUGHA ceannus na Dála agus adubhairt:-
3   116 22  178 1. CEANN COMHAIRLE I gCOIR AN LAE.  1919-01-21  Mr. Cathal Brugha   Sinn Féin   Waterford County    ' A cháirde, tá obair thábhachtach le déanamh annso indiu, an obair is tábhachtaighe do rinneadh in Éirinn ón lá tháinic na Gaedhil go hÉirinn, agus is naomhtha an obair í. Daoine go bhfuil dóchas aca as Dia iseadh sinn go léir, daoine a chuireann suim I ndlighthibh Dé, agus dá bhrigh sin budh chóir dúinn congnamh d'iarraidh ar Dhia I gcóir na hoibre atá againn le déanamh. Iarrfad anois ar an sagart is dúthrachtaighe dár mhair riamh I nÉirinn, an tAthair Micheál Ó Flannagáin, guidhe chum an Spiorad Naomh dúinn chum sinn do stiúradh ar ár leas ar an mbóthar atá againn le gabháil. ' ' Agus, a cháirde, pé cineál creidimh atá ag éinne annso, iarrfad ar gach n-aon paidir do chur suas chum Dé, ó íochtar a chroidhe chum cabhair do thabhairt dúinn indiu. Glaodhaim anois ar an Athair Micheál Ó Flannagáin. ' Do tháinig an tATHAIR MICHEÁL Ó FLANNAGÁIN I láthair na Dála agus do léigh an phaidir seo I n-ár ndiaidh: 'Tair, A Spioraid Naomh, ath-líon croidhthe t'fhíoraon, agus adhain ionnta teine do ghrádha. ' ' Cuir chugainn do Spioraid agus cruthóchfar iad agus athnuadhfaidh Tú aghaidh na talmhan.' ' Guidhmís: ' ' A Dhia, do theagaisc croidhthe sa bhfíoraon le lonnradh an Spioraid Naoimh, tabhair dúinn, san Spiorad cheudna, go mblaisfimíd an ceart agus go mbéidh síorgháirdeachais orainn de bhárr a shóláis sin. Tré Íosa Críost ár dTighearna. Ámén'</code></pre>
</div>
</div>
<p>The document itself in raw format is arranged in tabular form, separated by tabs. Each row contains a “document” (in this case, a speech) and the columns contain <strong>document-level</strong> variables. The column that contains the actual speech is named <code>speech</code>. To import this using <code>{readtext}</code>, you can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a>dat_dail <span class="ot">&lt;-</span> <span class="fu">readtext</span>(tsv_file, <span class="at">text_field =</span> <span class="st">"speech"</span>)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat_dail)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 33
Columns: 11
$ doc_id      &lt;chr&gt; "dailsample.tsv.1", "dailsample.tsv.2", "dailsample.tsv.3"…
$ text        &lt;chr&gt; "Molaimse don Dáil Cathal Brugha, an Teachta ó Dhéisibh Ph…
$ speechID    &lt;int&gt; 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16, 17,…
$ memberID    &lt;int&gt; 977, 1603, 116, 116, 116, 116, 496, 116, 116, 2095, 116, 1…
$ partyID     &lt;int&gt; 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22, 22…
$ constID     &lt;int&gt; 158, 103, 178, 178, 178, 178, 46, 178, 178, 139, 178, 178,…
$ title       &lt;chr&gt; "1. CEANN COMHAIRLE I gCOIR AN LAE.", "1. CEANN COMHAIRLE …
$ date        &lt;chr&gt; "1919-01-21", "1919-01-21", "1919-01-21", "1919-01-21", "1…
$ member_name &lt;chr&gt; "Count George Noble, Count Plunkett", "Mr. Pádraic Ó Máill…
$ party_name  &lt;chr&gt; "Sinn Féin", "Sinn Féin", "Sinn Féin", "Sinn Féin", "Sinn …
$ const_name  &lt;chr&gt; "Roscommon North", "Galway Connemara", "Waterford County",…</code></pre>
</div>
</div>
</section>
<section id="multiple-text-files" class="level3">
<h3 class="anchored" data-anchor-id="multiple-text-files">Multiple text files</h3>
<p>A second option to import data is to load multiple text files at once that are stored in the same folder or subfolders. Again, <code>path_data</code> is the location of sample files on your computer. Unlike the pre-formatted files, individual text files usually do not contain document-level variables. However, you can create document-level variables using the <code>{readtext}</code> package.</p>
<p>The directory <code>/txt/UDHR</code> contains text files (“.txt”) of the Universal Declaration of Human Rights in 13 languages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>path_udhr <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path_data, <span class="st">"/txt/UDHR"</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(path_udhr)  <span class="co"># list the files in this folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "UDHR_chinese.txt"    "UDHR_czech.txt"      "UDHR_danish.txt"    
 [4] "UDHR_english.txt"    "UDHR_french.txt"     "UDHR_georgian.txt"  
 [7] "UDHR_greek.txt"      "UDHR_hungarian.txt"  "UDHR_icelandic.txt" 
[10] "UDHR_irish.txt"      "UDHR_japanese.txt"   "UDHR_russian.txt"   
[13] "UDHR_vietnamese.txt"</code></pre>
</div>
</div>
<p>Each one of these txt files contains the text of the UDHR in the specific language. For instance, to inspect what each one of these files contain, we do the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># just first 5 lines</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a><span class="fu">cat</span>(<span class="fu">readLines</span>(<span class="fu">file.path</span>(path_udhr, <span class="st">"UDHR_chinese.txt"</span>), <span class="at">n =</span> <span class="dv">5</span>), <span class="at">sep =</span> <span class="st">"</span><span class="sc">\n</span><span class="st">"</span>)  </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>世界人权宣言
联合国大会一九四八年十二月十日第217A(III)号决议通过并颁布 1948 年 12 月 10 日， 联 合 国 大 会 通 过 并 颁 布《 世 界 人 权 宣 言》。 这 一 具 有 历 史 意 义 的《 宣 言》 颁 布 后， 大 会 要 求 所 有 会 员 国 广 为 宣 传， 并 且“ 不 分 国 家 或 领 土 的 政 治 地 位 , 主 要 在 各 级 学 校 和 其 他 教 育 机 构 加 以 传 播、 展 示、 阅 读 和 阐 述。” 《 宣 言 》 全 文 如 下： 序言 鉴于对人类家庭所有成员的固有尊严及其平等的和不移的权利的 承 认, 乃 是 世 界 自 由、 正 义 与 和 平 的 基 础, 鉴 于 对 人 权 的 无 视 和 侮 蔑 已 发 展 为 野 蛮 暴 行, 这 些 暴 行 玷 污 了 人 类 的 良 心, 而 一 个 人 人 享 有 言 论 和 信 仰 自 由 并 免 予 恐 惧 和 匮 乏 的 世 界 的 来 临, 已 被 宣 布 为 普 通 人 民 的 最 高 愿 望, 鉴 于 为 使 人 类 不 致 迫 不 得 已 铤 而 走 险 对 暴 政 和 压 迫 进 行 反 叛, 有 必 要 使 人 权 受 法 治 的 保 护, 鉴 于 有 必 要 促 进 各 国 间 友 好 关 系 的 发 展, 鉴于各联合国国家的人民已在联合国宪章中重申他们对基本人 权、 人 格 尊 严 和 价 值 以 及 男 女 平 等 权 利 的 信 念, 并 决 心 促 成 较 大 自 由 中 的 社 会 进 步 和 生 活 水 平 的 改 善, 鉴于各会员国业已誓愿同联合国合作以促进对人权和基本自由的 普 遍 尊 重 和 遵 行, 鉴于对这些权利和自由的普遍了解对于这个誓愿的充分实现具有 很 大 的 重 要 性, 因 此 现 在, 大 会, 发 布 这 一 世 界 人 权 宣 言 , 作 为 所 有 人 民 和 所 有 国 家 努 力 实 现 的 共 同 标 准, 以 期 每 一 个 人 和 社 会 机 构 经 常 铭 念 本 宣 言, 努 力 通 过 教 诲 和 教 育 促 进 对 权 利 和 自 由 的 尊 重, 并 通 过 国 家 的 和 国 际 的 渐 进 措 施, 使 这 些 权 利 和 自 由 在 各 会 员 国 本 身 人 民 及 在 其 管 辖 下 领 土 的 人 民 中 得 到 普 遍 和 有 效 的 承 认 和 遵 行; 第一条

人 人 生 而 自 由, 在 尊 严 和 权 利 上 一 律 平 等。 他 们 赋 有 理 性 和 良 心, 并 应 以 兄 弟 关 系 的 精 神 相 对 待。 第二条 人 人 有 资 格 享 有 本 宣 言 所 载 的 一 切 权 利 和 自 由, 不 分 种 族、 肤 色、 性 别、 语 言、 宗 教、 政 治 或 其 他 见 解、 国 籍 或 社 会 出 身、 财 产、 出 生 或 其 他 身 分 等 任 何 区 别。 并 且 不 得 因 一 人 所 属 的 国 家 或 领 土 的 政 治 的、 行 政 的 或 者 国 际 的 地 位 之 不 同 而 有 所 区 别, 无 论 该 领 土 是 独 立 领 土、 托 管 领 土、 非 自 治 领 土 或 者 处 于 其 他 任 何 主 权 受 限 制 的 情 况 之 下。 第三条 人 人 有 权 享 有 生 命、 自 由 和 人 身 安 全。 第四条 任 何 人 不 得 使 为 奴 隶 或 奴 役; 一 切 形 式 的 奴 隶 制 度 和 奴 隶 买 卖, 均 应 予 以 禁 止。 第五条 任 何 人 不 得 加 以 酷 刑, 或 施 以 残 忍 的、 不 人 道 的 或 侮 辱 性 的 待 遇 或 刑 罚。 第六条 人 人 在 任 何 地 方 有 权 被 承 认 在 法 律 前 的 人 格。 第七条</code></pre>
</div>
</div>
<p>To import these files, you can use the following code:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>dat_udhr <span class="ot">&lt;-</span> <span class="fu">readtext</span>(path_udhr)</span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat_udhr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 13
Columns: 2
$ doc_id &lt;chr&gt; "UDHR_chinese.txt", "UDHR_czech.txt", "UDHR_danish.txt", "UDHR_…
$ text   &lt;chr&gt; "世界人权宣言\n联合国大会一九四八年十二月十日第217A(III)号决议…</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>If you are using Windows, you need might need to specify the encoding of the file by adding <code>encoding = "utf-8"</code>. In this case, imported texts might appear like <code>&lt;U+4E16&gt;&lt;U+754C&gt;&lt;U+4EBA&gt;&lt;U+6743&gt;</code> but they indicate that Unicode charactes are imported correctly.</p>
</div>
</div>
<p>Here’s another example of multiple text files. The directory <code>/txt/EU_manifestos</code> contains text files (“.txt”) of the European Union manifestos in different languages.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>path_eu <span class="ot">&lt;-</span> <span class="fu">paste0</span>(path_data, <span class="st">"/txt/EU_manifestos/"</span>)</span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a><span class="fu">list.files</span>(path_eu)  <span class="co"># list the files in this folder</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "EU_euro_2004_de_PSE.txt" "EU_euro_2004_de_V.txt"  
 [3] "EU_euro_2004_en_PSE.txt" "EU_euro_2004_en_V.txt"  
 [5] "EU_euro_2004_es_PSE.txt" "EU_euro_2004_es_V.txt"  
 [7] "EU_euro_2004_fi_V.txt"   "EU_euro_2004_fr_PSE.txt"
 [9] "EU_euro_2004_fr_V.txt"   "EU_euro_2004_gr_V.txt"  
[11] "EU_euro_2004_hu_V.txt"   "EU_euro_2004_it_PSE.txt"
[13] "EU_euro_2004_lv_V.txt"   "EU_euro_2004_nl_V.txt"  
[15] "EU_euro_2004_pl_V.txt"   "EU_euro_2004_se_V.txt"  
[17] "EU_euro_2004_si_V.txt"  </code></pre>
</div>
</div>
<p>You can generate document-level variables based on the file names using the <code>docvarnames</code> and <code>docvarsfrom</code> argument. <code>dvsep = "_"</code> specifies the value separator in the filenames. <code>encoding = "ISO-8859-1"</code> determines character encodings of the texts. Notice how the document variables are nicely generated from the file names.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>dat_eu <span class="ot">&lt;-</span> <span class="fu">readtext</span>(</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">file =</span> path_eu,</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">docvarsfrom =</span> <span class="st">"filenames"</span>, </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">docvarnames =</span> <span class="fu">c</span>(<span class="st">"unit"</span>, <span class="st">"context"</span>, <span class="st">"year"</span>, <span class="st">"language"</span>, <span class="st">"party"</span>),</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">dvsep =</span> <span class="st">"_"</span>, </span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">encoding =</span> <span class="st">"ISO-8859-1"</span></span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat_eu)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 17
Columns: 7
$ doc_id   &lt;chr&gt; "EU_euro_2004_de_PSE.txt", "EU_euro_2004_de_V.txt", "EU_euro_…
$ text     &lt;chr&gt; "PES · PSE · SPE European Parliament rue Wiertz B 1047 Brusse…
$ unit     &lt;chr&gt; "EU", "EU", "EU", "EU", "EU", "EU", "EU", "EU", "EU", "EU", "…
$ context  &lt;chr&gt; "euro", "euro", "euro", "euro", "euro", "euro", "euro", "euro…
$ year     &lt;int&gt; 2004, 2004, 2004, 2004, 2004, 2004, 2004, 2004, 2004, 2004, 2…
$ language &lt;chr&gt; "de", "de", "en", "en", "es", "es", "fi", "fr", "fr", "gr", "…
$ party    &lt;chr&gt; "PSE", "V", "PSE", "V", "PSE", "V", "V", "PSE", "V", "V", "V"…</code></pre>
</div>
</div>
</section>
<section id="json" class="level3">
<h3 class="anchored" data-anchor-id="json">JSON</h3>
<p>You can also read JSON files (.json) downloaded from the Twititer stream API. <a href="https://raw.githubusercontent.com/quanteda/tutorials.quanteda.io/master/content/data/twitter.json">twitter.json</a> is located in data directory of this tutorial package.</p>
<p>The JSON file looks something like this</p>
<pre><code>{"created_at":"Wed Jun 07 23:30:01 +0000 2017","id":872596537142116352,"id_str":"872596537142116352","text":"@EFC_Jayy UKIP","display_text_range":[10,14],
"source":"\u003ca href=\"http:\/\/twitter.com\/download\/iphone\" rel=\"nofollow\"\u003eTwitter for iPhone\u003c\/a\u003e","truncated":false,"in_reply_to_status_id":872596176834572288,
"in_reply_to_status_id_str":"872596176834572288","in_reply_to_user_id":4556760676,"in_reply_to_user_id_str":"4556760676","in_reply_to_screen_name":"EFC_Jayy","user":{"id":863929468984995840,"id_str":"863929468984995840","name":"\u30b8\u30e7\u30fc\u30b8","screen_name":"CoysJoji","location":"Japan","url":null,"description":null,"protected":false,
"verified":false,"followers_count":367,"friends_count":304,"listed_count":1,"favourites_count":1260,"statuses_count":2930,"created_at":"Mon May 15 01:30:11 +0000 2017","utc_offset":null,"time_zone":null,"geo_enabled":false,"lang":"en","contributors_enabled":false,"is_translator":false,"profile_background_color":"F5F8FA","profile_background_image_url":"","profile_background_image_url_https":"","profile_background_tile":false,
"profile_link_color":"1DA1F2","profile_sidebar_border_color":"C0DEED","profile_sidebar_fill_color":"DDEEF6","profile_text_color":"333333","profile_use_background_image":true,"profile_image_url":"http:\/\/pbs.twimg.com\/profile_images\/870447188400365568\/RiR1hbCe_normal.jpg",
"profile_image_url_https":"https:\/\/pbs.twimg.com\/profile_images\/870447188400365568\/RiR1hbCe_normal.jpg","profile_banner_url":"https:\/\/pbs.twimg.com\/profile_banners\/863929468984995840\/1494897624","default_profile":true,"default_profile_image":false,"following":null,"follow_request_sent":null,"notifications":null},"geo":null,"coordinates":null,
"place":null,"contributors":null,"is_quote_status":false,"retweet_count":0,"favorite_count":0,"entities":{"hashtags":[],"urls":[],"user_mentions":[{"screen_name":"EFC_Jayy","name":"\u274c\u274c\u274c","id":4556760676,"id_str":"4556760676","indices":[0,9]}],"symbols":[]},"favorited":false,"retweeted":false,"filter_level":"low","lang":"en","timestamp_ms":"1496878201171"}</code></pre>
<p>It’s a little hard to parse, but luckily we just leave it to the <code>{readtext}</code> package to do the job for us.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a>dat_twitter <span class="ot">&lt;-</span> <span class="fu">readtext</span>(<span class="st">"../data/twitter.json"</span>, <span class="at">source =</span> <span class="st">"twitter"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The file comes with several metadata for each tweet, such as the number of retweets and likes, the username, time and time zone.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">names</span>(dat_twitter))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<pre><code>## [1] "doc_id"         "text"           "retweet_count"  "favorite_count"
## [5] "favorited"      "truncated"</code></pre>
</section>
<section id="pdf" class="level3">
<h3 class="anchored" data-anchor-id="pdf">PDF</h3>
<p><code>readtext()</code> can also convert and read PDF (“.pdf”) files. The directory <code>/pdf/UDHR</code> contains PDF files of the Universal Declaration of Human Rights in 13 languages. Each file looks like this:</p>
<p><img src="figures/udhr_sample.png" class="img-fluid"></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>dat_udhr <span class="ot">&lt;-</span> <span class="fu">readtext</span>(</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">paste0</span>(path_data, <span class="st">"/pdf/UDHR/*.pdf"</span>), </span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">docvarsfrom =</span> <span class="st">"filenames"</span>, </span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">docvarnames =</span> <span class="fu">c</span>(<span class="st">"document"</span>, <span class="st">"language"</span>),</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">sep =</span> <span class="st">"_"</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dat_udhr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>readtext object consisting of 11 documents and 2 docvars.
# A data frame: 11 × 4
  doc_id           text                          document language
  &lt;chr&gt;            &lt;chr&gt;                         &lt;chr&gt;    &lt;chr&gt;   
1 UDHR_chinese.pdf "\"世界人权宣言\n\n联合\"..." UDHR     chinese 
2 UDHR_czech.pdf   "\"VŠEOBECNÁ \"..."           UDHR     czech   
3 UDHR_danish.pdf  "\"Den 10. de\"..."           UDHR     danish  
4 UDHR_english.pdf "\"Universal \"..."           UDHR     english 
5 UDHR_french.pdf  "\"Déclaratio\"..."           UDHR     french  
6 UDHR_greek.pdf   "\"ΟΙΚΟΥΜΕΝΙΚ\"..."           UDHR     greek   
# ℹ 5 more rows</code></pre>
</div>
</div>
</section>
<section id="microsoft-word" class="level3">
<h3 class="anchored" data-anchor-id="microsoft-word">Microsoft Word</h3>
<p>Finally, <code>readtext()</code> can import Microsoft Word (“.doc” and “.docx”) files.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a>dat_word <span class="ot">&lt;-</span> <span class="fu">readtext</span>(<span class="fu">paste0</span>(path_data, <span class="st">"/word/*.docx"</span>))</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dat_udhr)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>readtext object consisting of 11 documents and 2 docvars.
# A data frame: 11 × 4
  doc_id           text                          document language
  &lt;chr&gt;            &lt;chr&gt;                         &lt;chr&gt;    &lt;chr&gt;   
1 UDHR_chinese.pdf "\"世界人权宣言\n\n联合\"..." UDHR     chinese 
2 UDHR_czech.pdf   "\"VŠEOBECNÁ \"..."           UDHR     czech   
3 UDHR_danish.pdf  "\"Den 10. de\"..."           UDHR     danish  
4 UDHR_english.pdf "\"Universal \"..."           UDHR     english 
5 UDHR_french.pdf  "\"Déclaratio\"..."           UDHR     french  
6 UDHR_greek.pdf   "\"ΟΙΚΟΥΜΕΝΙΚ\"..."           UDHR     greek   
# ℹ 5 more rows</code></pre>
</div>
</div>
</section>
</section>
<section id="workflow" class="level2">
<h2 class="anchored" data-anchor-id="workflow">Workflow</h2>
<p><code>{quanteda}</code> has three basic types of objects:</p>
<ol type="1">
<li><p>Corpus</p>
<ul>
<li>Saves character strings and variables in a data frame</li>
<li>Combines texts with document-level variables</li>
</ul></li>
<li><p>Tokens</p>
<ul>
<li>Stores tokens in a list of vectors</li>
<li>More efficient than character strings, but preserves positions of words</li>
<li>Positional (string-of-words) analysis is performed using <code>textstat_collocations()</code>, <code>tokens_ngrams()</code> and <code>tokens_select()</code> or <code>fcm()</code> with <code>window</code> option</li>
</ul></li>
<li><p>Document-feature matrix (DFM)</p>
<ul>
<li>Represents frequencies of features in documents in a matrix</li>
<li>The most efficient structure, but it does not have information on positions of words</li>
<li>Non-positional (bag-of-words) analysis are profrmed using many of the <code>textstat_*</code> and <code>textmodel_*</code> functions</li>
</ul></li>
</ol>
<p>Text analysis with <code>{quanteda}</code> goes through all those three types of objects either explicitly or implicitly.</p>
<div class="cell" data-layout-align="default">
<div class="cell-output-display">
<div>
<p></p><figure class="figure"><p></p>
<div>
<pre class="mermaid mermaid-js">    graph TD
    D[Text files]
    V[Document-level variables]
    C(Corpus)
    T(Tokens)
    AP["Positional analysis (string-of-words)"]
    AN["Non-positional analysis (bag-of-words)"]
    M(DFM)
    style C stroke-width:4px
    style T stroke-width:4px
    style M stroke-width:4px
    D --&gt; C
    V --&gt; C 
    C --&gt; T 
    T --&gt; M
    T -.-&gt; AP
    M -.-&gt; AN
</pre>
</div>
<p></p></figure><p></p>
</div>
</div>
</div>
<p>For example, if character vectors are given to <code>dfm()</code>, it internally constructs corpus and tokens objects before creating a DFM.</p>
<section id="corpus" class="level3">
<h3 class="anchored" data-anchor-id="corpus">Corpus</h3>
<p>You can create a corpus from various available sources:</p>
<ol type="1">
<li><p>A character vector consisting of one document per element</p></li>
<li><p>A data frame consisting of a character vector for documents, and additional vectors for document-level variables</p></li>
</ol>
<section id="character-vector" class="level4">
<h4 class="anchored" data-anchor-id="character-vector">Character vector</h4>
<p><code>data_char_ukimmig2010</code> is a named character vector and consists of sections of British election manifestos on immigration and asylum.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">str</span>(data_char_ukimmig2010)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> Named chr [1:9] "IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN SOLVE. \n\n- At current immigration and birth rates,"| __truncated__ ...
 - attr(*, "names")= chr [1:9] "BNP" "Coalition" "Conservative" "Greens" ...</code></pre>
</div>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a>corp_immig <span class="ot">&lt;-</span> <span class="fu">corpus</span>(</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>  data_char_ukimmig2010, </span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">docvars =</span> <span class="fu">data.frame</span>(<span class="at">party =</span> <span class="fu">names</span>(data_char_ukimmig2010))</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(corp_immig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 9 documents and 1 docvar.
BNP :
"IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN S..."

Coalition :
"IMMIGRATION.  The Government believes that immigration has e..."

Conservative :
"Attract the brightest and best to our country. Immigration h..."

Greens :
"Immigration. Migration is a fact of life.  People have alway..."

Labour :
"Crime and immigration The challenge for Britain We will cont..."

LibDem :
"firm but fair immigration system Britain has always been an ..."

[ reached max_ndoc ... 3 more documents ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(corp_immig)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 9 documents, showing 9 documents:

         Text Types Tokens Sentences        party
          BNP  1125   3280        88          BNP
    Coalition   142    260         4    Coalition
 Conservative   251    499        15 Conservative
       Greens   322    679        21       Greens
       Labour   298    683        29       Labour
       LibDem   251    483        14       LibDem
           PC    77    114         5           PC
          SNP    88    134         4          SNP
         UKIP   346    723        26         UKIP</code></pre>
</div>
</div>
</section>
<section id="data-frame" class="level4">
<h4 class="anchored" data-anchor-id="data-frame">Data frame</h4>
<p>Using <code>read_csv()</code>, load an example file from <code>path_data</code> as a data frame called <code>dat_inaug</code>. Note that your file does not need to be formatted as <code>.csv</code>. You can build a <code>{quanteda}</code> corpus from any file format that R can import as a data frame (see, for instance, the <a href="https://cran.r-project.org/web/packages/rio/index.html"><strong>rio</strong></a> package for importing various files as data frames into R).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># set path</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>path_data <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">"extdata/"</span>, <span class="at">package =</span> <span class="st">"readtext"</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># import csv file</span></span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>dat_inaug <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(<span class="fu">paste0</span>(path_data, <span class="st">"/csv/inaugCorpus.csv"</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(dat_inaug)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] "texts"     "Year"      "President" "FirstName"</code></pre>
</div>
</div>
<p>Construct a corpus from the “texts” column in <code>dat_inaug</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>corp_inaug <span class="ot">&lt;-</span> <span class="fu">corpus</span>(dat_inaug, <span class="at">text_field =</span> <span class="st">"texts"</span>)</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(corp_inaug)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 5 documents and 3 docvars.
text1 :
"Fellow-Citizens of the Senate and of the House of Representa..."

text2 :
"Fellow citizens, I am again called upon by the voice of my c..."

text3 :
"When it was first perceived, in early times, that no middle ..."

text4 :
"Friends and Fellow Citizens: Called upon to undertake the du..."

text5 :
"Proceeding, fellow citizens, to that qualification which the..."</code></pre>
</div>
</div>
</section>
<section id="document-level-variables" class="level4">
<h4 class="anchored" data-anchor-id="document-level-variables">Document-level variables</h4>
<p><code>{quanteda}</code>’s objects keep information associated with documents. They are called “document-level variables”, or “docvars”, and are accessed using <code>docvars()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>corp <span class="ot">&lt;-</span> data_corpus_inaugural</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">docvars</span>(corp))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year  President FirstName                 Party
1 1789 Washington    George                  none
2 1793 Washington    George                  none
3 1797      Adams      John            Federalist
4 1801  Jefferson    Thomas Democratic-Republican
5 1805  Jefferson    Thomas Democratic-Republican
6 1809    Madison     James Democratic-Republican</code></pre>
</div>
</div>
<p>If you want to extract individual elements of document variables, you can specify <code>field</code>. Or you could just subset it as you normally would a data.frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(corp, <span class="at">field =</span> <span class="st">"Year"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1789 1793 1797 1801 1805 1809 1813 1817 1821 1825 1829 1833 1837 1841 1845
[16] 1849 1853 1857 1861 1865 1869 1873 1877 1881 1885 1889 1893 1897 1901 1905
[31] 1909 1913 1917 1921 1925 1929 1933 1937 1941 1945 1949 1953 1957 1961 1965
[46] 1969 1973 1977 1981 1985 1989 1993 1997 2001 2005 2009 2013 2017 2021</code></pre>
</div>
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>corp<span class="sc">$</span>Year</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] 1789 1793 1797 1801 1805 1809 1813 1817 1821 1825 1829 1833 1837 1841 1845
[16] 1849 1853 1857 1861 1865 1869 1873 1877 1881 1885 1889 1893 1897 1901 1905
[31] 1909 1913 1917 1921 1925 1929 1933 1937 1941 1945 1949 1953 1957 1961 1965
[46] 1969 1973 1977 1981 1985 1989 1993 1997 2001 2005 2009 2013 2017 2021</code></pre>
</div>
</div>
<p>So that means assignments to <em>change</em> document-level variables will work as usual in R. For example, you can change the <code>Year</code> variable to a factor (if you wished). And since the output of a <code>docvars()</code> function is a data.frame, you could subset or filter as you would a data.frame.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="fu">docvars</span>(corp) <span class="sc">|&gt;</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;=</span> <span class="dv">1990</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>  Year President FirstName      Party
1 1993   Clinton      Bill Democratic
2 1997   Clinton      Bill Democratic
3 2001      Bush George W. Republican
4 2005      Bush George W. Republican
5 2009     Obama    Barack Democratic
6 2013     Obama    Barack Democratic
7 2017     Trump Donald J. Republican
8 2021     Biden Joseph R. Democratic</code></pre>
</div>
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># {quanteda} also provides corpus_subset() function, but since we learnt about</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># dplyr, we can use it here.</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Another useful feature is the ability to change the unit of texts. For example, the UK Immigration 2010 data set is a corpus of 9 documents, where each document is a speech by the political party.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a>corp <span class="ot">&lt;-</span> <span class="fu">corpus</span>(data_char_ukimmig2010)</span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(corp)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 9 documents.
BNP :
"IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN S..."

Coalition :
"IMMIGRATION.  The Government believes that immigration has e..."

Conservative :
"Attract the brightest and best to our country. Immigration h..."

Greens :
"Immigration. Migration is a fact of life.  People have alway..."

Labour :
"Crime and immigration The challenge for Britain We will cont..."

LibDem :
"firm but fair immigration system Britain has always been an ..."

[ reached max_ndoc ... 3 more documents ]</code></pre>
</div>
</div>
<p>We can use <code>corpus_reshape()</code> to change the unit of texts. For example, we can change the unit of texts to sentences using the command below.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a>corp_sent <span class="ot">&lt;-</span> <span class="fu">corpus_reshape</span>(corp, <span class="at">to =</span> <span class="st">"sentences"</span>)</span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(corp_sent)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 206 documents.
BNP.1 :
"IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN S..."

BNP.2 :
"The Scale of the Crisis  Britain's existence is in grave per..."

BNP.3 :
"In the absence of urgent action, we, the indigenous British ..."

BNP.4 :
"We, alone of all the political parties, have a decades-long ..."

BNP.5 :
"British People Set to be a Minority within 30 - 50 Years: Th..."

BNP.6 :
"Figures released by the ONS in January 2009 revealed that th..."

[ reached max_ndoc ... 200 more documents ]</code></pre>
</div>
</div>
<p>The following code restores it back to the document level.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>corp_doc <span class="ot">&lt;-</span> <span class="fu">corpus_reshape</span>(corp_sent, <span class="at">to =</span> <span class="st">"documents"</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(corp_doc)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Corpus consisting of 9 documents.
BNP :
"IMMIGRATION: AN UNPARALLELED CRISIS WHICH ONLY THE BNP CAN S..."

Coalition :
"IMMIGRATION.  The Government believes that immigration has e..."

Conservative :
"Attract the brightest and best to our country.  Immigration ..."

Greens :
"Immigration.  Migration is a fact of life.  People have alwa..."

Labour :
"Crime and immigration  The challenge for Britain  We will co..."

LibDem :
"firm but fair immigration system  Britain has always been an..."

[ reached max_ndoc ... 3 more documents ]</code></pre>
</div>
</div>
</section>
</section>
<section id="tokens" class="level3">
<h3 class="anchored" data-anchor-id="tokens">Tokens</h3>
<p><code>tokens()</code> segments texts in a corpus into tokens (words or sentences) by word boundaries. By default, tokens() only removes separators (typically white spaces), but you can also remove punctuation and numbers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a>toks <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corp_immig)</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(toks)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tokens consisting of 9 documents and 1 docvar.
BNP :
 [1] "IMMIGRATION"  ":"            "AN"           "UNPARALLELED" "CRISIS"      
 [6] "WHICH"        "ONLY"         "THE"          "BNP"          "CAN"         
[11] "SOLVE"        "."           
[ ... and 3,268 more ]

Coalition :
 [1] "IMMIGRATION" "."           "The"         "Government"  "believes"   
 [6] "that"        "immigration" "has"         "enriched"    "our"        
[11] "culture"     "and"        
[ ... and 248 more ]

Conservative :
 [1] "Attract"     "the"         "brightest"   "and"         "best"       
 [6] "to"          "our"         "country"     "."           "Immigration"
[11] "has"         "enriched"   
[ ... and 487 more ]

Greens :
 [1] "Immigration" "."           "Migration"   "is"          "a"          
 [6] "fact"        "of"          "life"        "."           "People"     
[11] "have"        "always"     
[ ... and 667 more ]

Labour :
 [1] "Crime"       "and"         "immigration" "The"         "challenge"  
 [6] "for"         "Britain"     "We"          "will"        "control"    
[11] "immigration" "with"       
[ ... and 671 more ]

LibDem :
 [1] "firm"        "but"         "fair"        "immigration" "system"     
 [6] "Britain"     "has"         "always"      "been"        "an"         
[11] "open"        ","          
[ ... and 471 more ]

[ reached max_ndoc ... 3 more documents ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a>toks_nopunct <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_char_ukimmig2010, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(toks_nopunct)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tokens consisting of 9 documents.
BNP :
 [1] "IMMIGRATION"  "AN"           "UNPARALLELED" "CRISIS"       "WHICH"       
 [6] "ONLY"         "THE"          "BNP"          "CAN"          "SOLVE"       
[11] "At"           "current"     
[ ... and 2,839 more ]

Coalition :
 [1] "IMMIGRATION"  "The"          "Government"   "believes"     "that"        
 [6] "immigration"  "has"          "enriched"     "our"          "culture"     
[11] "and"          "strengthened"
[ ... and 219 more ]

Conservative :
 [1] "Attract"     "the"         "brightest"   "and"         "best"       
 [6] "to"          "our"         "country"     "Immigration" "has"        
[11] "enriched"    "our"        
[ ... and 440 more ]

Greens :
 [1] "Immigration" "Migration"   "is"          "a"           "fact"       
 [6] "of"          "life"        "People"      "have"        "always"     
[11] "moved"       "from"       
[ ... and 598 more ]

Labour :
 [1] "Crime"       "and"         "immigration" "The"         "challenge"  
 [6] "for"         "Britain"     "We"          "will"        "control"    
[11] "immigration" "with"       
[ ... and 608 more ]

LibDem :
 [1] "firm"        "but"         "fair"        "immigration" "system"     
 [6] "Britain"     "has"         "always"      "been"        "an"         
[11] "open"        "welcoming"  
[ ... and 423 more ]

[ reached max_ndoc ... 3 more documents ]</code></pre>
</div>
</div>
<p>You can see how keywords are used in the actual contexts in a concordance view produced by <code>kwic()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a>kw <span class="ot">&lt;-</span> <span class="fu">kwic</span>(toks, <span class="at">pattern =</span>  <span class="st">"immig*"</span>)</span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(kw, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Keyword-in-context with 10 matches.                                                                 
   [BNP, 1]                                       | IMMIGRATION |
  [BNP, 16]                   SOLVE. - At current | immigration |
  [BNP, 78]                 a halt to all further | immigration |
  [BNP, 85]        the deportation of all illegal | immigrants  |
 [BNP, 169]          Britain, regardless of their | immigration |
 [BNP, 197] admission that they orchestrated mass | immigration |
 [BNP, 272]            grave peril, threatened by | immigration |
 [BNP, 374]                  ), legal Third World | immigrants  |
 [BNP, 531]        to second and third generation |  immigrant  |
 [BNP, 661]                     are added in, the |  immigrant  |
                                          
 : AN UNPARALLELED CRISIS WHICH           
 and birth rates, indigenous              
 , the deportation of all                 
 , a halt to the                          
 status. - The BNP                        
 to change forcibly Britain's demographics
 and multiculturalism. In the             
 made up 14.7 percent (                   
 mothers. Figures released by             
 birth rate is estimated to               </code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<ol type="1">
<li><p>If you want to find multi-word expressions, separate words by white space and wrap the character vector by <code>phrase()</code>, as follows:</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>kw_asylum <span class="ot">&lt;-</span> <span class="fu">kwic</span>(toks, <span class="at">pattern =</span> <span class="fu">phrase</span>(<span class="st">"asylum seeker*"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div></li>
<li><p>Texts do not always appear nicely in your R console, so you can use <code>View()</code> to see the keywords-in-context in an interactive HTML table.</p></li>
</ol>
</div>
</div>
<p>You can remove tokens that you are not interested in using <code>tokens_select()</code>. Usually we remove function words (grammatical words) that have little or no substantive meaning in pre-processing. <code>stopwords()</code> returns a pre-defined list of function words.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a>toks_nostop <span class="ot">&lt;-</span> <span class="fu">tokens_select</span>(</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a>  toks, </span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="fu">stopwords</span>(<span class="st">"en"</span>), </span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">selection =</span> <span class="st">"remove"</span>  <span class="co"># keep or remove</span></span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(toks_nostop)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Tokens consisting of 9 documents and 1 docvar.
BNP :
 [1] "IMMIGRATION"  ":"            "UNPARALLELED" "CRISIS"       "BNP"         
 [6] "CAN"          "SOLVE"        "."            "-"            "current"     
[11] "immigration"  "birth"       
[ ... and 2,109 more ]

Coalition :
 [1] "IMMIGRATION"  "."            "Government"   "believes"     "immigration" 
 [6] "enriched"     "culture"      "strengthened" "economy"      ","           
[11] "must"         "controlled"  
[ ... and 146 more ]

Conservative :
 [1] "Attract"     "brightest"   "best"        "country"     "."          
 [6] "Immigration" "enriched"    "nation"      "years"       "want"       
[11] "attract"     "brightest"  
[ ... and 277 more ]

Greens :
 [1] "Immigration" "."           "Migration"   "fact"        "life"       
 [6] "."           "People"      "always"      "moved"       "one"        
[11] "country"     "another"    
[ ... and 377 more ]

Labour :
 [1] "Crime"            "immigration"      "challenge"        "Britain"         
 [5] "control"          "immigration"      "new"              "Australian-style"
 [9] "points-based"     "system"           "-"                "unlike"          
[ ... and 391 more ]

LibDem :
 [1] "firm"        "fair"        "immigration" "system"      "Britain"    
 [6] "always"      "open"        ","           "welcoming"   "country"    
[11] ","           "thousands"  
[ ... and 285 more ]

[ reached max_ndoc ... 3 more documents ]</code></pre>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The <code>stopwords()</code> function returns character vectors of stopwords for different languages, using the ISO-639-1 language codes. For <strong>Malay</strong>, use <code>stopwords("ms", source = "stopwords-iso")</code>. For Bruneian specific context, you may need to amend the stopwords yourselves.</p>
</div>
</div>
<p>You can generate n-grams in any lengths from a tokens using <code>tokens_ngrams()</code>. N-grams are a contiguous sequence of n tokens from already tokenized text objects. So for example, in the phrase “natural language processing”:</p>
<ul>
<li>Unigram (1-gram): “natural”, “language”, “processing”</li>
<li>Bigram (2-gram): “natural language”, “language processing”</li>
<li>Trigram (3-gram): “natural language processing”</li>
</ul>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># tokens_ngrams() also supports skip to generate skip-grams.</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a>toks_ngram <span class="ot">&lt;-</span> <span class="fu">tokens_ngrams</span>(toks_nopunct, <span class="at">n =</span> <span class="dv">3</span>, <span class="at">skip =</span> <span class="dv">0</span>)</span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(toks_ngram[[<span class="dv">1</span>]], <span class="dv">20</span>)  <span class="co"># the first political party's trigrams</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code> [1] "IMMIGRATION_AN_UNPARALLELED" "AN_UNPARALLELED_CRISIS"     
 [3] "UNPARALLELED_CRISIS_WHICH"   "CRISIS_WHICH_ONLY"          
 [5] "WHICH_ONLY_THE"              "ONLY_THE_BNP"               
 [7] "THE_BNP_CAN"                 "BNP_CAN_SOLVE"              
 [9] "CAN_SOLVE_At"                "SOLVE_At_current"           
[11] "At_current_immigration"      "current_immigration_and"    
[13] "immigration_and_birth"       "and_birth_rates"            
[15] "birth_rates_indigenous"      "rates_indigenous_British"   
[17] "indigenous_British_people"   "British_people_are"         
[19] "people_are_set"              "are_set_to"                 </code></pre>
</div>
</div>
</section>
<section id="document-feature-matrix" class="level3">
<h3 class="anchored" data-anchor-id="document-feature-matrix">Document feature matrix</h3>
<p><code>dfm()</code> constructs a document-feature matrix (DFM) from a tokens object.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb70"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a>toks_inaug <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_corpus_inaugural, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a>dfmat_inaug <span class="ot">&lt;-</span> <span class="fu">dfm</span>(toks_inaug)</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="fu">print</span>(dfmat_inaug)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 59 documents, 9,419 features (91.89% sparse) and 4 docvars.
                 features
docs              fellow-citizens  of the senate and house representatives
  1789-Washington               1  71 116      1  48     2               2
  1793-Washington               0  11  13      0   2     0               0
  1797-Adams                    3 140 163      1 130     0               2
  1801-Jefferson                2 104 130      0  81     0               0
  1805-Jefferson                0 101 143      0  93     0               0
  1809-Madison                  1  69 104      0  43     0               0
                 features
docs              among vicissitudes incident
  1789-Washington     1            1        1
  1793-Washington     0            0        0
  1797-Adams          4            0        0
  1801-Jefferson      1            0        0
  1805-Jefferson      7            0        0
  1809-Madison        0            0        0
[ reached max_ndoc ... 53 more documents, reached max_nfeat ... 9,409 more features ]</code></pre>
</div>
</div>
<p>Some useful functions to operate on DFMs are:</p>
<ol type="1">
<li><code>ndoc()</code>: returns the number of documents</li>
<li><code>nfeat()</code>: returns the number of features</li>
<li><code>docnames()</code>: returns the document names</li>
<li><code>featnames()</code>: returns the feature (column) names</li>
<li><code>topfeatures()</code>: returns the most frequent features</li>
<li><code>docvars()</code>: returns the document-level variables</li>
</ol>
<p>DFMs sometimes behaves like normal matrices too, so you can use <code>rowSums()</code> and <code>colSums()</code> to calculate marginals.</p>
<p>Most commonly perhaps, is you want to select some columns (i.e.&nbsp;features) from the DFM that satisfy a pattern. For instance,</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb72"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dfm_select</span>(dfmat_inaug, <span class="at">pattern =</span> <span class="st">"freedom"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 59 documents, 1 feature (38.98% sparse) and 4 docvars.
                 features
docs              freedom
  1789-Washington       0
  1793-Washington       0
  1797-Adams            0
  1801-Jefferson        4
  1805-Jefferson        2
  1809-Madison          1
[ reached max_ndoc ... 53 more documents ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb74"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="fu">dfm_keep</span>(dfmat_inaug, <span class="at">min_nchar =</span> <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 59 documents, 8,560 features (93.04% sparse) and 4 docvars.
                 features
docs              fellow-citizens senate house representatives among
  1789-Washington               1      1     2               2     1
  1793-Washington               0      0     0               0     0
  1797-Adams                    3      1     0               2     4
  1801-Jefferson                2      0     0               0     1
  1805-Jefferson                0      0     0               0     7
  1809-Madison                  1      0     0               0     0
                 features
docs              vicissitudes incident event could filled
  1789-Washington            1        1     2     3      1
  1793-Washington            0        0     0     0      0
  1797-Adams                 0        0     0     1      0
  1801-Jefferson             0        0     0     0      0
  1805-Jefferson             0        0     0     2      0
  1809-Madison               0        0     0     1      1
[ reached max_ndoc ... 53 more documents, reached max_nfeat ... 8,550 more features ]</code></pre>
</div>
</div>
<p>There is also <code>dfm_trim()</code> to remove features that are too frequent or too rare, based on frequencies.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb76"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trim DFM containing features that occur less than 10 times in the corpus</span></span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dfm_trim</span>(dfmat_inaug, <span class="at">min_termfreq =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 59 documents, 1,524 features (68.93% sparse) and 4 docvars.
                 features
docs              fellow-citizens  of the senate and house representatives
  1789-Washington               1  71 116      1  48     2               2
  1793-Washington               0  11  13      0   2     0               0
  1797-Adams                    3 140 163      1 130     0               2
  1801-Jefferson                2 104 130      0  81     0               0
  1805-Jefferson                0 101 143      0  93     0               0
  1809-Madison                  1  69 104      0  43     0               0
                 features
docs              among to life
  1789-Washington     1 48    1
  1793-Washington     0  5    0
  1797-Adams          4 72    2
  1801-Jefferson      1 61    1
  1805-Jefferson      7 83    2
  1809-Madison        0 61    1
[ reached max_ndoc ... 53 more documents, reached max_nfeat ... 1,514 more features ]</code></pre>
</div>
<div class="sourceCode cell-code" id="cb78"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Trim DFM containing features that occur in more than 10% of the documents</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="fu">dfm_trim</span>(dfmat_inaug, <span class="at">max_docfreq =</span> <span class="fl">0.1</span>, <span class="at">docfreq_type =</span> <span class="st">"prop"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Document-feature matrix of: 59 documents, 7,388 features (96.87% sparse) and 4 docvars.
                 features
docs              vicissitudes filled anxieties notification transmitted 14th
  1789-Washington            1      1         1            1           1    1
  1793-Washington            0      0         0            0           0    0
  1797-Adams                 0      0         0            0           0    0
  1801-Jefferson             0      0         0            0           0    0
  1805-Jefferson             0      0         0            0           0    0
  1809-Madison               0      1         0            0           0    0
                 features
docs              month summoned veneration fondest
  1789-Washington     1        1          1       1
  1793-Washington     0        0          0       0
  1797-Adams          0        0          2       0
  1801-Jefferson      0        0          0       0
  1805-Jefferson      0        0          0       0
  1809-Madison        0        0          0       0
[ reached max_ndoc ... 53 more documents, reached max_nfeat ... 7,378 more features ]</code></pre>
</div>
</div>
</section>
</section>
<section id="statistical-analysis" class="level2">
<h2 class="anchored" data-anchor-id="statistical-analysis">Statistical analysis</h2>
<p>Note: If you have not installed <code>{quanteda.corpora}</code>, do so by running</p>
<div class="sourceCode" id="cb80"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb80-1"><a href="#cb80-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">"quanteda/quanteda.corpora"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<section id="simple-frequency-analysis" class="level3">
<h3 class="anchored" data-anchor-id="simple-frequency-analysis">Simple frequency analysis</h3>
<p>Unlike <code>topfeatures()</code>, <code>textstat_frequency()</code> shows both term and document frequencies. You can also use the function to find the most frequent features within groups. Using the <code>download()</code> function from <code>{quanteda.corpora}</code>, you can retrieve a text corpus of tweets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb81"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1" aria-hidden="true" tabindex="-1"></a>corp_tweets <span class="ot">&lt;-</span> quanteda.corpora<span class="sc">::</span><span class="fu">download</span>(<span class="at">url =</span> <span class="st">"https://www.dropbox.com/s/846skn1i5elbnd2/data_corpus_sampletweets.rds?dl=1"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>We can analyse the most frequent hashtags by applying <code>tokens_keep(pattern = "#*")</code> before creating a DFM.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb82"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb82-1"><a href="#cb82-1" aria-hidden="true" tabindex="-1"></a>toks_tweets <span class="ot">&lt;-</span> </span>
<span id="cb82-2"><a href="#cb82-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>(corp_tweets, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb82-3"><a href="#cb82-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_keep</span>(<span class="at">pattern =</span> <span class="st">"#*"</span>)</span>
<span id="cb82-4"><a href="#cb82-4" aria-hidden="true" tabindex="-1"></a>dfmat_tweets <span class="ot">&lt;-</span> <span class="fu">dfm</span>(toks_tweets)</span>
<span id="cb82-5"><a href="#cb82-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb82-6"><a href="#cb82-6" aria-hidden="true" tabindex="-1"></a>tstat_freq <span class="ot">&lt;-</span> <span class="fu">textstat_frequency</span>(dfmat_tweets, <span class="at">n =</span> <span class="dv">5</span>, <span class="at">groups =</span> lang)</span>
<span id="cb82-7"><a href="#cb82-7" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(tstat_freq, <span class="dv">20</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>             feature frequency rank docfreq     group
1           #twitter         1    1       1    Basque
2     #canviemeuropa         1    1       1    Basque
3             #prest         1    1       1    Basque
4           #psifizo         1    1       1    Basque
5     #ekloges2014gr         1    1       1    Basque
6            #ep2014         1    1       1 Bulgarian
7         #yourvoice         1    1       1 Bulgarian
8      #eudebate2014         1    1       1 Bulgarian
9            #велико         1    1       1 Bulgarian
10           #ep2014         1    1       1  Croatian
11 #savedonbaspeople         1    1       1  Croatian
12   #vitoriagasteiz         1    1       1  Croatian
13           #ep14dk        32    1      32    Danish
14            #dkpol        18    2      18    Danish
15            #eupol         7    3       7    Danish
16        #vindtilep         7    3       7    Danish
17    #patentdomstol         4    5       4    Danish
18           #ep2014        35    1      35     Dutch
19              #vvd        11    2      11     Dutch
20               #eu         9    3       7     Dutch</code></pre>
</div>
</div>
<p>You can also plot the Twitter hashtag frequencies easily using <code>ggplot()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb84"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1" aria-hidden="true" tabindex="-1"></a>dfmat_tweets <span class="sc">|&gt;</span></span>
<span id="cb84-2"><a href="#cb84-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">textstat_frequency</span>(<span class="at">n =</span> <span class="dv">15</span>) <span class="sc">|&gt;</span></span>
<span id="cb84-3"><a href="#cb84-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> <span class="fu">reorder</span>(feature, frequency), <span class="at">y =</span> frequency)) <span class="sc">+</span></span>
<span id="cb84-4"><a href="#cb84-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb84-5"><a href="#cb84-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_flip</span>() <span class="sc">+</span></span>
<span id="cb84-6"><a href="#cb84-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="cn">NULL</span>, <span class="at">y =</span> <span class="st">"Frequency"</span>) <span class="sc">+</span></span>
<span id="cb84-7"><a href="#cb84-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-38-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Alternatively, you can create a word cloud of the 100 most common hashtags.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb85"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">132</span>)</span>
<span id="cb85-2"><a href="#cb85-2" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_wordcloud</span>(dfmat_tweets, <span class="at">max_words =</span> <span class="dv">100</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-39-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, it is possible to compare different groups within one Wordcloud. We must first create a dummy variable that indicates whether a tweet was posted in English or a different language. Afterwards, we can compare the most frequent hashtags of English and non-English tweets.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb86"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create document-level variable indicating whether tweet was in English or</span></span>
<span id="cb86-2"><a href="#cb86-2" aria-hidden="true" tabindex="-1"></a><span class="co"># other language</span></span>
<span id="cb86-3"><a href="#cb86-3" aria-hidden="true" tabindex="-1"></a>corp_tweets<span class="sc">$</span>dummy_english <span class="ot">&lt;-</span> </span>
<span id="cb86-4"><a href="#cb86-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">factor</span>(<span class="fu">ifelse</span>(corp_tweets<span class="sc">$</span>lang <span class="sc">==</span> <span class="st">"English"</span>, <span class="st">"English"</span>, <span class="st">"Not English"</span>))</span>
<span id="cb86-5"><a href="#cb86-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-6"><a href="#cb86-6" aria-hidden="true" tabindex="-1"></a><span class="co"># tokenize texts</span></span>
<span id="cb86-7"><a href="#cb86-7" aria-hidden="true" tabindex="-1"></a>toks_tweets <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corp_tweets)</span>
<span id="cb86-8"><a href="#cb86-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-9"><a href="#cb86-9" aria-hidden="true" tabindex="-1"></a><span class="co"># create a grouped dfm and compare groups</span></span>
<span id="cb86-10"><a href="#cb86-10" aria-hidden="true" tabindex="-1"></a>dfmat_corp_language <span class="ot">&lt;-</span> </span>
<span id="cb86-11"><a href="#cb86-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>(toks_tweets) <span class="sc">|&gt;</span></span>
<span id="cb86-12"><a href="#cb86-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_keep</span>(<span class="at">pattern =</span> <span class="st">"#*"</span>) <span class="sc">|&gt;</span></span>
<span id="cb86-13"><a href="#cb86-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_group</span>(<span class="at">groups =</span> dummy_english)</span>
<span id="cb86-14"><a href="#cb86-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb86-15"><a href="#cb86-15" aria-hidden="true" tabindex="-1"></a><span class="co"># create wordcloud</span></span>
<span id="cb86-16"><a href="#cb86-16" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">132</span>) <span class="co"># set seed for reproducibility</span></span>
<span id="cb86-17"><a href="#cb86-17" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_wordcloud</span>(dfmat_corp_language, <span class="at">comparison =</span> <span class="cn">TRUE</span>, <span class="at">max_words =</span> <span class="dv">200</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-40-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="lexical-diversity" class="level3">
<h3 class="anchored" data-anchor-id="lexical-diversity">Lexical diversity</h3>
<p>Lexical diversity is a measure of how varied the vocabulary in a text or speech is. It indicates the richness of language use by comparing the number of unique words (types) to the total number of words (tokens) in the text. It is useful, for instance, for analysing speakers’ or writers’ linguistic skills, or the complexity of ideas expressed in documents.</p>
<p>A common metric for lexical diversity is the Type-Token Ratio (TTR), calculated as: <span class="math display">\[
TTR = \frac{N_{\text{types}}}{N_{\text{tokens}}}
\]</span></p>
<div class="cell">
<div class="sourceCode cell-code" id="cb87"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1" aria-hidden="true" tabindex="-1"></a>toks_inaug <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_corpus_inaugural)</span>
<span id="cb87-2"><a href="#cb87-2" aria-hidden="true" tabindex="-1"></a>dfmat_inaug <span class="ot">&lt;-</span> </span>
<span id="cb87-3"><a href="#cb87-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>(toks_inaug) <span class="sc">|&gt;</span></span>
<span id="cb87-4"><a href="#cb87-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_remove</span>(<span class="at">pattern =</span> <span class="fu">stopwords</span>(<span class="st">"en"</span>))  <span class="co"># similar to dfm_select()</span></span>
<span id="cb87-5"><a href="#cb87-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb87-6"><a href="#cb87-6" aria-hidden="true" tabindex="-1"></a>tstat_lexdiv <span class="ot">&lt;-</span> <span class="fu">textstat_lexdiv</span>(dfmat_inaug)</span>
<span id="cb87-7"><a href="#cb87-7" aria-hidden="true" tabindex="-1"></a><span class="fu">tail</span>(tstat_lexdiv, <span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>     document       TTR
55  2005-Bush 0.6176753
56 2009-Obama 0.6828645
57 2013-Obama 0.6605238
58 2017-Trump 0.6409537
59 2021-Biden 0.5572316</code></pre>
</div>
</div>
<p>We can prepare a plot using <code>ggplot()</code> as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb89"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1" aria-hidden="true" tabindex="-1"></a>plot_df <span class="ot">&lt;-</span></span>
<span id="cb89-2"><a href="#cb89-2" aria-hidden="true" tabindex="-1"></a>  tstat_lexdiv <span class="sc">|&gt;</span></span>
<span id="cb89-3"><a href="#cb89-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">id =</span> <span class="fu">row_number</span>())</span>
<span id="cb89-4"><a href="#cb89-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb89-5"><a href="#cb89-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(plot_df, <span class="fu">aes</span>(id, TTR)) <span class="sc">+</span></span>
<span id="cb89-6"><a href="#cb89-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb89-7"><a href="#cb89-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(</span>
<span id="cb89-8"><a href="#cb89-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">breaks =</span> plot_df<span class="sc">$</span>id,</span>
<span id="cb89-9"><a href="#cb89-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">labels =</span> plot_df<span class="sc">$</span>document,</span>
<span id="cb89-10"><a href="#cb89-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">name =</span> <span class="cn">NULL</span></span>
<span id="cb89-11"><a href="#cb89-11" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb89-12"><a href="#cb89-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels =</span> scales<span class="sc">::</span>percent) <span class="sc">+</span></span>
<span id="cb89-13"><a href="#cb89-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb89-14"><a href="#cb89-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-42-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="documentfeature-similarity" class="level3">
<h3 class="anchored" data-anchor-id="documentfeature-similarity">Document/Feature similarity</h3>
<p>Document/feature similarity is a measure of how alike two documents or sets of features are based on their content. It quantifies the degree to which documents share similar terms, topics, or characteristics.</p>
<p><code>textstat_dist()</code> calculates similarities of documents or features for various measures. The output is compatible with R’s <code>dist()</code>, so hierarchical clustering can be performed without any transformation.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb90"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1" aria-hidden="true" tabindex="-1"></a>toks_inaug <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_corpus_inaugural)</span>
<span id="cb90-2"><a href="#cb90-2" aria-hidden="true" tabindex="-1"></a>dfmat_inaug <span class="ot">&lt;-</span> </span>
<span id="cb90-3"><a href="#cb90-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>(toks_inaug) <span class="sc">|&gt;</span></span>
<span id="cb90-4"><a href="#cb90-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_remove</span>(<span class="at">pattern =</span> <span class="fu">stopwords</span>(<span class="st">"en"</span>))  <span class="co"># similar to dfm_select()</span></span>
<span id="cb90-5"><a href="#cb90-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb90-6"><a href="#cb90-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Calculate document similarity</span></span>
<span id="cb90-7"><a href="#cb90-7" aria-hidden="true" tabindex="-1"></a>dist_mat <span class="ot">&lt;-</span> <span class="fu">textstat_dist</span>(dfmat_inaug)  <span class="co"># using Euclidean distance</span></span>
<span id="cb90-8"><a href="#cb90-8" aria-hidden="true" tabindex="-1"></a>dist_mat[<span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>3 x 3 Matrix of class "dspMatrix"
                1789-Washington 1793-Washington 1797-Adams
1789-Washington         0.00000        76.13803   141.4072
1793-Washington        76.13803         0.00000   206.6954
1797-Adams            141.40721       206.69543     0.0000</code></pre>
</div>
</div>
<p>To plot this using <code>ggplot()</code>, we rely on the <code>{ggdendro}</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb92"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1" aria-hidden="true" tabindex="-1"></a>clust <span class="ot">&lt;-</span> <span class="fu">hclust</span>(<span class="fu">as.dist</span>(dist_mat))  <span class="co"># hierarchical clustering</span></span>
<span id="cb92-2"><a href="#cb92-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb92-3"><a href="#cb92-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(ggdendro)</span>
<span id="cb92-4"><a href="#cb92-4" aria-hidden="true" tabindex="-1"></a>dendr <span class="ot">&lt;-</span> <span class="fu">dendro_data</span>(clust)</span>
<span id="cb92-5"><a href="#cb92-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggdendrogram</span>(dendr, <span class="at">rotate =</span> <span class="cn">TRUE</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="feature-co-occurence-matrix" class="level3">
<h3 class="anchored" data-anchor-id="feature-co-occurence-matrix">Feature co-occurence matrix</h3>
<p>A feature co-occurrence matrix (FCM) is a square matrix that counts the number of times two features co-occur in the same context, such as within the same document, sentence, or window of text. This is a special object in <code>{quanteda}</code>, but behaves similarly to a DFM. As an example, consider the following:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb93"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb93-1"><a href="#cb93-1" aria-hidden="true" tabindex="-1"></a><span class="fu">tibble</span>(</span>
<span id="cb93-2"><a href="#cb93-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">doc_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>,</span>
<span id="cb93-3"><a href="#cb93-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">text =</span> <span class="fu">c</span>(<span class="st">"I love Mathematics."</span>, <span class="st">"Mathematics is awesome."</span>)</span>
<span id="cb93-4"><a href="#cb93-4" aria-hidden="true" tabindex="-1"></a>) <span class="sc">|&gt;</span></span>
<span id="cb93-5"><a href="#cb93-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corpus</span>() <span class="sc">|&gt;</span></span>
<span id="cb93-6"><a href="#cb93-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>(<span class="at">remove_punct =</span> <span class="cn">TRUE</span>) <span class="sc">|&gt;</span></span>
<span id="cb93-7"><a href="#cb93-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fcm</span>(<span class="at">context =</span> <span class="st">"document"</span>)  <span class="co"># by default</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Feature co-occurrence matrix of: 5 by 5 features.
             features
features      I love Mathematics is awesome
  I           0    1           1  0       0
  love        0    0           1  0       0
  Mathematics 0    0           0  1       1
  is          0    0           0  0       1
  awesome     0    0           0  0       0</code></pre>
</div>
</div>
<p>Let’s download the <code>data_corpus_guardian</code> corpus from the <code>{quanteda.corpora}</code> package.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb95"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1" aria-hidden="true" tabindex="-1"></a>corp_news <span class="ot">&lt;-</span> quanteda.corpora<span class="sc">::</span><span class="fu">download</span>(<span class="st">"data_corpus_guardian"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>When a corpus is large, you have to select features of a DFM before constructing a FCM. In the example below, we clean up as follows:</p>
<ol type="1">
<li>Remove all stopwords and punctuation characters.</li>
<li>Remove certain patterns that usually describe the publication time and date of articles.</li>
<li>Keep only terms that occur at least 100 times in the document-feature matrix.</li>
</ol>
<div class="cell">
<div class="sourceCode cell-code" id="cb96"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1" aria-hidden="true" tabindex="-1"></a>toks_news <span class="ot">&lt;-</span> <span class="fu">tokens</span>(corp_news, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb96-2"><a href="#cb96-2" aria-hidden="true" tabindex="-1"></a>dfmat_news <span class="ot">&lt;-</span> </span>
<span id="cb96-3"><a href="#cb96-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>(toks_news) <span class="sc">|&gt;</span></span>
<span id="cb96-4"><a href="#cb96-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_remove</span>(<span class="at">pattern =</span> <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), <span class="st">"*-time"</span>, <span class="st">"updated-*"</span>, <span class="st">"gmt"</span>, <span class="st">"bst"</span>, <span class="st">"|"</span>)) <span class="sc">|&gt;</span></span>
<span id="cb96-5"><a href="#cb96-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_trim</span>(<span class="at">min_termfreq =</span> <span class="dv">100</span>)</span>
<span id="cb96-6"><a href="#cb96-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb96-7"><a href="#cb96-7" aria-hidden="true" tabindex="-1"></a><span class="fu">topfeatures</span>(dfmat_news)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      said     people        one        new       also         us        can 
     28413      11169       9884       8024       7901       7091       6972 
government       year       last 
      6821       6570       6335 </code></pre>
</div>
<div class="sourceCode cell-code" id="cb98"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb98-1"><a href="#cb98-1" aria-hidden="true" tabindex="-1"></a><span class="fu">nfeat</span>(dfmat_news)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 4211</code></pre>
</div>
</div>
<p>To construct an FCM from a DFM (or a tokens object), use <code>fcm()</code>. You can visualise the FCM using a <code>textplot_network()</code> graph as follows:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb100"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1" aria-hidden="true" tabindex="-1"></a>fcmat_news <span class="ot">&lt;-</span> <span class="fu">fcm</span>(dfmat_news, <span class="at">context =</span> <span class="st">"document"</span>)</span>
<span id="cb100-2"><a href="#cb100-2" aria-hidden="true" tabindex="-1"></a>feat <span class="ot">&lt;-</span> <span class="fu">names</span>(<span class="fu">topfeatures</span>(dfmat_news, <span class="dv">30</span>))  <span class="co"># Top 30 features</span></span>
<span id="cb100-3"><a href="#cb100-3" aria-hidden="true" tabindex="-1"></a>fcmat_news_select <span class="ot">&lt;-</span> <span class="fu">fcm_select</span>(fcmat_news, <span class="at">pattern =</span> feat, <span class="at">selection =</span> <span class="st">"keep"</span>)</span>
<span id="cb100-4"><a href="#cb100-4" aria-hidden="true" tabindex="-1"></a><span class="fu">dim</span>(fcmat_news_select)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 30 30</code></pre>
</div>
<div class="sourceCode cell-code" id="cb102"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb102-1"><a href="#cb102-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">123</span>)</span>
<span id="cb102-2"><a href="#cb102-2" aria-hidden="true" tabindex="-1"></a>quanteda.textplots<span class="sc">::</span><span class="fu">textplot_network</span>(fcmat_news_select)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
</section>
</section>
<section id="scaling-and-classification" class="level2">
<h2 class="anchored" data-anchor-id="scaling-and-classification">Scaling and classification</h2>
<p>In this section we apply mainly unsupervised learning models to textual data. Scaling and classification aim to uncover hidden structures, relationships, and patterns within textual data by placing texts or words on latent scales (scaling) and grouping them into meaningful categories or themes (classification). This process transforms complex, high-dimensional text into more interpretable and actionable insights.</p>
<section id="wordfish" class="level3">
<h3 class="anchored" data-anchor-id="wordfish">Wordfish</h3>
<p>Wordfish is a Poisson scaling model of one-dimensional document positions <span class="citation" data-cites="slapin2008scaling">(<a href="#ref-slapin2008scaling" role="doc-biblioref">Slapin and Proksch 2008</a>)</span>. This model is used primarily for scaling political texts to position documents (like speeches or manifestos) on a latent dimension, often reflecting ideological or policy positions. The main objective is to identify the relative positioning of texts on a scale (e.g., left-right political spectrum) based on word frequencies.</p>
<p>Let <span class="math inline">\(y_{ij}\)</span> be the count of word <span class="math inline">\(j\)</span> in document <span class="math inline">\(i\)</span>. Then assume <span class="math display">\[
\begin{align}
y_{ij} &amp;\sim \operatorname{Poi}(\lambda_{ij}) \\
\log (\lambda_{ij}) &amp;= \psi_j +\beta_j \theta_i
\end{align}
\]</span></p>
<p>In this example, we will show how to apply Wordfish to the Irish budget speeches from 2010. First, we will create a document-feature matrix. Afterwards, we will run Wordfish.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb103"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb103-1"><a href="#cb103-1" aria-hidden="true" tabindex="-1"></a>toks_irish <span class="ot">&lt;-</span> <span class="fu">tokens</span>(data_corpus_irishbudget2010, <span class="at">remove_punct =</span> <span class="cn">TRUE</span>)</span>
<span id="cb103-2"><a href="#cb103-2" aria-hidden="true" tabindex="-1"></a>dfmat_irish <span class="ot">&lt;-</span> <span class="fu">dfm</span>(toks_irish)</span>
<span id="cb103-3"><a href="#cb103-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb103-4"><a href="#cb103-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Run Wordfish model</span></span>
<span id="cb103-5"><a href="#cb103-5" aria-hidden="true" tabindex="-1"></a>tmod_wf <span class="ot">&lt;-</span> <span class="fu">textmodel_wordfish</span>(dfmat_irish, <span class="at">dir =</span> <span class="fu">c</span>(<span class="dv">6</span>, <span class="dv">5</span>))</span>
<span id="cb103-6"><a href="#cb103-6" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(tmod_wf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
textmodel_wordfish.dfm(x = dfmat_irish, dir = c(6, 5))

Estimated Document Positions:
                             theta      se
Lenihan, Brian (FF)        1.79403 0.02007
Bruton, Richard (FG)      -0.62160 0.02823
Burton, Joan (LAB)        -1.13503 0.01568
Morgan, Arthur (SF)       -0.07841 0.02896
Cowen, Brian (FF)          1.77846 0.02330
Kenny, Enda (FG)          -0.75350 0.02635
ODonnell, Kieran (FG)     -0.47615 0.04309
Gilmore, Eamon (LAB)      -0.58406 0.02994
Higgins, Michael (LAB)    -1.00383 0.03964
Quinn, Ruairi (LAB)       -0.92648 0.04183
Gormley, John (Green)      1.18361 0.07224
Ryan, Eamon (Green)        0.14738 0.06321
Cuffe, Ciaran (Green)      0.71541 0.07291
OCaolain, Caoimhghin (SF) -0.03982 0.03878

Estimated Feature Scores:
        when      i presented    the supplementary  budget     to   this  house
beta -0.1594 0.3177    0.3603 0.1933         1.077 0.03537 0.3077 0.2473 0.1399
psi   1.6241 2.7239   -1.7958 5.3308        -1.134 2.70993 4.5190 3.4603 1.0396
       last   april    said     we   could   work    our   way through  period
beta 0.2419 -0.1565 -0.8339 0.4156 -0.6138 0.5221 0.6892 0.275  0.6115  0.4985
psi  0.9853 -0.5725 -0.4514 3.5125  1.0858 1.1151 2.5278 1.419  1.1603 -0.1779
         of severe economic distress   today   can  report    that
beta 0.2777  1.229   0.4237    1.799 0.09141 0.304  0.6196 0.01506
psi  4.4656 -2.013   1.5714   -4.456 0.83875 1.564 -0.2466 3.83785
     notwithstanding difficulties   past
beta           1.799        1.175 0.4746
psi           -4.456       -1.357 0.9321</code></pre>
</div>
</div>
<p>The R output shows the results of the Wordfish model applied to Irish political texts, estimating the ideological positions of various politicians. Each politician is assigned a “theta” value, representing their placement on a latent scale; positive values indicate one end of the spectrum, while negative values indicate the opposite.</p>
<p>For example, Brian Lenihan (FF) has a high positive theta, suggesting a strong position on one side, while Joan Burton (LAB) has a negative theta, placing her on the other side. The model also provides feature scores for words (beta values), indicating their importance in distinguishing between these positions. Words with higher absolute beta values, such as “supplementary,” are key in differentiating the ideological content of the texts, while psi values reflect word frequency variance, contributing to the model’s differentiation of document positions.</p>
<p>We can plot the results of a fitted scaling model using <code>textplot_scale1d()</code>.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb105"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb105-1"><a href="#cb105-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(tmod_wf)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-51-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<div class="callout callout-style-default callout-note callout-titled">
<div class="callout-header d-flex align-content-center">
<div class="callout-icon-container">
<i class="callout-icon"></i>
</div>
<div class="callout-title-container flex-fill">
Note
</div>
</div>
<div class="callout-body-container callout-body">
<p>The value of 0 for theta in the Wordfish model is not a true zero in an absolute sense. Instead, it serves as a relative reference point on the latent scale. In Wordfish, theta values are relative, meaning they indicate positions along a spectrum where the direction (positive or negative) is determined by the model’s scaling based on the data and specified parameters.</p>
</div>
</div>
<p>The function also allows you to plot scores by a grouping variable, in this case the party affiliation of the speakers.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb106"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb106-1"><a href="#cb106-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(tmod_wf, <span class="at">groups =</span> dfmat_irish<span class="sc">$</span>party)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-52-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Finally, we can plot the estimated word positions and highlight certain features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb107"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb107-1"><a href="#cb107-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_scale1d</span>(</span>
<span id="cb107-2"><a href="#cb107-2" aria-hidden="true" tabindex="-1"></a>  tmod_wf, </span>
<span id="cb107-3"><a href="#cb107-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">margin =</span> <span class="st">"features"</span>, </span>
<span id="cb107-4"><a href="#cb107-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">highlighted =</span> <span class="fu">c</span>(<span class="st">"government"</span>, <span class="st">"global"</span>, <span class="st">"children"</span>, </span>
<span id="cb107-5"><a href="#cb107-5" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"bank"</span>, <span class="st">"economy"</span>, <span class="st">"the"</span>, <span class="st">"citizenship"</span>,</span>
<span id="cb107-6"><a href="#cb107-6" aria-hidden="true" tabindex="-1"></a>                  <span class="st">"productivity"</span>, <span class="st">"deficit"</span>)</span>
<span id="cb107-7"><a href="#cb107-7" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-53-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Beta (x-axis) Reflects how strongly a word is associated with the latent dimension (e.g., ideological position). Words with high absolute beta values are more influential in distinguishing between different positions; positive beta values indicate words more associated with one end of the scale, while negative values indicate the opposite.</p>
<p>Psi (y-axis) Represents the variance in word frequency. Higher psi values suggest that the word occurs with varying frequency across documents, while lower values indicate more consistent usage.</p>
<p>Therefore, words in the upper right (high beta, high psi) are influential and variably used, indicating key terms that may strongly differentiate between document positions. Words in the lower left (low beta, low psi) are less influential and consistently used, likely serving as common or neutral terms.</p>
<p>The plot also helps identify which words are driving the distinctions in the latent scale and how their usage varies across documents.</p>
</section>
<section id="topic-models" class="level3">
<h3 class="anchored" data-anchor-id="topic-models">Topic models</h3>
<p>Topic models are statistical models used to identify the underlying themes or topics within a large collection of documents. They analyze word co-occurrences across documents to group words into topics, where each topic is a distribution over words, and each document is a mixture of these topics.</p>
<p>A common topic model is Latent Dirichlet Allocation (LDA), which assumes that each document contains multiple topics in varying proportions. Topic models help uncover hidden semantic structures in text, making them useful for organizing, summarizing, and exploring large text datasets. In R, we use the <code>{seededlda}</code> package for LDA.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb108"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb108-1"><a href="#cb108-1" aria-hidden="true" tabindex="-1"></a><span class="co"># install.packages("seededlda")</span></span>
<span id="cb108-2"><a href="#cb108-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(seededlda)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Back to the Guardian data, <code>corp_news</code>. We will select only news articles published in 2016 using <code>corpus_subset()</code> function and the <code>year()</code> function from the <code>{lubridate}</code> package</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb109"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb109-1"><a href="#cb109-1" aria-hidden="true" tabindex="-1"></a>corp_news_2016 <span class="ot">&lt;-</span> <span class="fu">corpus_subset</span>(corp_news, <span class="fu">year</span>(date) <span class="sc">==</span> <span class="dv">2016</span>)</span>
<span id="cb109-2"><a href="#cb109-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ndoc</span>(corp_news_2016)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>[1] 1959</code></pre>
</div>
</div>
<p>Further, after removal of function words and punctuation in <code>dfm()</code>, we will only keep the top 20% of the most frequent features (<code>min_termfreq = 0.8</code>) that appear in less than 10% of all documents (<code>max_docfreq = 0.1</code>) using <code>dfm_trim()</code> to focus on common but distinguishing features.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb111"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb111-1"><a href="#cb111-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Create tokens</span></span>
<span id="cb111-2"><a href="#cb111-2" aria-hidden="true" tabindex="-1"></a>toks_news <span class="ot">&lt;-</span> </span>
<span id="cb111-3"><a href="#cb111-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>(</span>
<span id="cb111-4"><a href="#cb111-4" aria-hidden="true" tabindex="-1"></a>    corp_news_2016, </span>
<span id="cb111-5"><a href="#cb111-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, </span>
<span id="cb111-6"><a href="#cb111-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, </span>
<span id="cb111-7"><a href="#cb111-7" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_symbol =</span> <span class="cn">TRUE</span></span>
<span id="cb111-8"><a href="#cb111-8" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">|&gt;</span></span>
<span id="cb111-9"><a href="#cb111-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens_remove</span>(</span>
<span id="cb111-10"><a href="#cb111-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">pattern =</span> <span class="fu">c</span>(<span class="fu">stopwords</span>(<span class="st">"en"</span>), <span class="st">"*-time"</span>, <span class="st">"updated-*"</span>, <span class="st">"gmt"</span>, <span class="st">"bst"</span>)</span>
<span id="cb111-11"><a href="#cb111-11" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb111-12"><a href="#cb111-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb111-13"><a href="#cb111-13" aria-hidden="true" tabindex="-1"></a><span class="co"># Create DFM</span></span>
<span id="cb111-14"><a href="#cb111-14" aria-hidden="true" tabindex="-1"></a>dfmat_news <span class="ot">&lt;-</span> </span>
<span id="cb111-15"><a href="#cb111-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>(toks_news) <span class="sc">%&gt;%</span> </span>
<span id="cb111-16"><a href="#cb111-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_trim</span>(</span>
<span id="cb111-17"><a href="#cb111-17" aria-hidden="true" tabindex="-1"></a>    <span class="at">min_termfreq =</span> <span class="fl">0.8</span>, </span>
<span id="cb111-18"><a href="#cb111-18" aria-hidden="true" tabindex="-1"></a>    <span class="at">termfreq_type =</span> <span class="st">"quantile"</span>,</span>
<span id="cb111-19"><a href="#cb111-19" aria-hidden="true" tabindex="-1"></a>    <span class="at">max_docfreq =</span> <span class="fl">0.1</span>, </span>
<span id="cb111-20"><a href="#cb111-20" aria-hidden="true" tabindex="-1"></a>    <span class="at">docfreq_type =</span> <span class="st">"prop"</span></span>
<span id="cb111-21"><a href="#cb111-21" aria-hidden="true" tabindex="-1"></a>  )</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>The LDA is fitted using the code below. Note that <code>k = 10</code> specifies the number of topics to be discovered. This is an important parameter and you should try a variety of values and validate the outputs of your topic models thoroughly.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb112"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb112-1"><a href="#cb112-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Takes a while to fit!</span></span>
<span id="cb112-2"><a href="#cb112-2" aria-hidden="true" tabindex="-1"></a>tmod_lda <span class="ot">&lt;-</span> seededlda<span class="sc">::</span><span class="fu">textmodel_lda</span>(dfmat_news, <span class="at">k =</span> <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You can extract the most important terms for each topic from the model using <code>terms()</code>. Each column (<code>topic1</code>, <code>topic2</code>, etc.) lists words that frequently co-occur in the dataset, suggesting a common theme within each topic.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb113"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb113-1"><a href="#cb113-1" aria-hidden="true" tabindex="-1"></a><span class="fu">terms</span>(tmod_lda, <span class="dv">10</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>      topic1     topic2       topic3         topic4       topic5    topic6    
 [1,] "syria"    "labor"      "johnson"      "funding"    "son"     "officers"
 [2,] "refugees" "australia"  "brussels"     "housing"    "church"  "violence"
 [3,] "isis"     "australian" "talks"        "nhs"        "black"   "doctors" 
 [4,] "military" "corbyn"     "boris"        "income"     "love"    "prison"  
 [5,] "syrian"   "turnbull"   "benefits"     "education"  "father"  "victims" 
 [6,] "un"       "budget"     "summit"       "scheme"     "felt"    "sexual"  
 [7,] "islamic"  "leadership" "negotiations" "fund"       "parents" "abuse"   
 [8,] "forces"   "shadow"     "ireland"      "green"      "story"   "hospital"
 [9,] "turkey"   "senate"     "migrants"     "homes"      "visit"   "criminal"
[10,] "muslim"   "coalition"  "greece"       "businesses" "read"    "crime"   
      topic7      topic8    topic9          topic10     
 [1,] "oil"       "clinton" "climate"       "sales"     
 [2,] "markets"   "sanders" "water"         "apple"     
 [3,] "prices"    "cruz"    "energy"        "customers" 
 [4,] "banks"     "hillary" "food"          "users"     
 [5,] "investors" "obama"   "gas"           "google"    
 [6,] "shares"    "trump's" "drug"          "technology"
 [7,] "trading"   "bernie"  "drugs"         "games"     
 [8,] "china"     "ted"     "environmental" "game"      
 [9,] "rates"     "rubio"   "air"           "iphone"    
[10,] "quarter"   "senator" "emissions"     "app"       </code></pre>
</div>
</div>
<p>As an example, Topic 1 (“syria”, “refugees”, “isis”), is likely related to international conflicts, specifically around Syria and refugee crises. Topic 4 (“funding”, “housing”, “nhs”) is likely related to public services and social welfare issues, such as healthcare and housing. Each topic provides a distinct theme, derived from the words that frequently appear together in the corpus, helping to summarize and understand the main themes in the text.</p>
<p>You can then obtain the most likely topics using topics() and save them as a document-level variable.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb115"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb115-1"><a href="#cb115-1" aria-hidden="true" tabindex="-1"></a><span class="co"># assign topic as a new document-level variable</span></span>
<span id="cb115-2"><a href="#cb115-2" aria-hidden="true" tabindex="-1"></a>dfmat_news<span class="sc">$</span>topic <span class="ot">&lt;-</span> <span class="fu">topics</span>(tmod_lda)</span>
<span id="cb115-3"><a href="#cb115-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb115-4"><a href="#cb115-4" aria-hidden="true" tabindex="-1"></a><span class="co"># cross-table of the topic frequency</span></span>
<span id="cb115-5"><a href="#cb115-5" aria-hidden="true" tabindex="-1"></a><span class="fu">table</span>(dfmat_news<span class="sc">$</span>topic)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
 topic1  topic2  topic3  topic4  topic5  topic6  topic7  topic8  topic9 topic10 
    203     222      85     211     249     236     180     186     196     184 </code></pre>
</div>
</div>
<p>In the seeded LDA, you can pre-define topics in LDA using a dictionary of “seeded” words. For more information, see the <code>{seededlda}</code> package documentation.</p>
</section>
<section id="latent-semantic-scaling" class="level3">
<h3 class="anchored" data-anchor-id="latent-semantic-scaling">Latent semantic scaling</h3>
<p>Latent Semantic Scaling (LSS) is a method used to place words or documents on a latent scale that represents an underlying dimension, such as sentiment, ideology, or any other semantic axis. The key idea is to use the co-occurrence patterns of words across documents to identify and position items along this hidden dimension.</p>
<p>LSS is performed using the <code>{LSX}</code> package. In this example, we will apply LSS to the corpus of Sputnik articles about Ukraine. First, we prepare the data set.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb117"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb117-1"><a href="#cb117-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Read the RDS file directly from the URL</span></span>
<span id="cb117-2"><a href="#cb117-2" aria-hidden="true" tabindex="-1"></a>corp <span class="ot">&lt;-</span> <span class="fu">readRDS</span>(<span class="fu">url</span>(<span class="st">"https://www.dropbox.com/s/abme18nlrwxgmz8/data_corpus_sputnik2022.rds?dl=1"</span>))</span>
<span id="cb117-3"><a href="#cb117-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-4"><a href="#cb117-4" aria-hidden="true" tabindex="-1"></a>toks <span class="ot">&lt;-</span></span>
<span id="cb117-5"><a href="#cb117-5" aria-hidden="true" tabindex="-1"></a>  corp <span class="sc">|&gt;</span></span>
<span id="cb117-6"><a href="#cb117-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">corpus_reshape</span>(<span class="st">"sentences"</span>) <span class="sc">|&gt;</span>  <span class="co"># this is a must!</span></span>
<span id="cb117-7"><a href="#cb117-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">tokens</span>(</span>
<span id="cb117-8"><a href="#cb117-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_punct =</span> <span class="cn">TRUE</span>, </span>
<span id="cb117-9"><a href="#cb117-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_symbols =</span> <span class="cn">TRUE</span>, </span>
<span id="cb117-10"><a href="#cb117-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_numbers =</span> <span class="cn">TRUE</span>, </span>
<span id="cb117-11"><a href="#cb117-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">remove_url =</span> <span class="cn">TRUE</span></span>
<span id="cb117-12"><a href="#cb117-12" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb117-13"><a href="#cb117-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb117-14"><a href="#cb117-14" aria-hidden="true" tabindex="-1"></a>dfmt <span class="ot">&lt;-</span></span>
<span id="cb117-15"><a href="#cb117-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm</span>(toks) <span class="sc">|&gt;</span></span>
<span id="cb117-16"><a href="#cb117-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dfm_remove</span>(<span class="at">pattern =</span> <span class="fu">stopwords</span>(<span class="st">"en"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Now to run an LSS model, run the following command:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb118"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb118-1"><a href="#cb118-1" aria-hidden="true" tabindex="-1"></a>lss <span class="ot">&lt;-</span> <span class="fu">textmodel_lss</span>(</span>
<span id="cb118-2"><a href="#cb118-2" aria-hidden="true" tabindex="-1"></a>  dfmt, </span>
<span id="cb118-3"><a href="#cb118-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">seeds =</span> <span class="fu">as.seedwords</span>(data_dictionary_sentiment), </span>
<span id="cb118-4"><a href="#cb118-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">k =</span> <span class="dv">300</span>, </span>
<span id="cb118-5"><a href="#cb118-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># cache = TRUE, </span></span>
<span id="cb118-6"><a href="#cb118-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">include_data =</span> <span class="cn">TRUE</span>, </span>
<span id="cb118-7"><a href="#cb118-7" aria-hidden="true" tabindex="-1"></a>  <span class="at">group_data =</span> <span class="cn">TRUE</span></span>
<span id="cb118-8"><a href="#cb118-8" aria-hidden="true" tabindex="-1"></a>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Taking the DFM and the seed words as the only inputs, <code>textmodel_lss()</code> computes the <em>polarity</em> scores of all the words in the corpus based on their semantic similarity to the seed words. You usually do not need to change the value of <code>k</code> (300 by default).</p>
<p>Let’s look at the output of the LSS model:</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb119"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb119-1"><a href="#cb119-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(lss)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>
Call:
textmodel_lss(x = dfmt, seeds = as.seedwords(data_dictionary_sentiment), 
    k = 300, include_data = TRUE, group_data = TRUE)

Seeds:
       good        nice   excellent    positive   fortunate     correct 
          1           1           1           1           1           1 
   superior         bad       nasty        poor    negative unfortunate 
          1          -1          -1          -1          -1          -1 
      wrong    inferior 
         -1          -1 

Beta:
(showing first 30 elements)
          excellent            positive              gander                good 
             0.2102              0.1918              0.1883              0.1829 
         diplomatic           staffer's              ex-kgb             correct 
             0.1802              0.1773              0.1771              0.1749 
               mend  inter-parliamntary         workmanship      russo-american 
             0.1743              0.1719              0.1715              0.1713 
             nicety           china-u.s               soufi good-neighborliness 
             0.1712              0.1674              0.1664              0.1644 
       china-canada             fidgety           relations           downtrend 
             0.1616              0.1611              0.1584              0.1578 
            cordial        canada-china            superior       understanding 
             0.1573              0.1569              0.1569              0.1561 
   good-neighbourly           brennan's              mutual          reaffirmed 
             0.1550              0.1544              0.1538              0.1534 
              blida          abdelkader 
             0.1533              0.1533 

Data Dimension:
[1]  8063 59711</code></pre>
</div>
</div>
<p>Polarity scores in Latent Semantic Scaling (LSS) quantify how words or documents relate to a specific dimension (e.g., sentiment) based on predefined seed words. Seed words represent the extremes of this dimension (e.g., “good” vs.&nbsp;“bad”). LSS analyzes how other words co-occur with these seed words to assign a score.</p>
<p>We can visualize the polarity of words using <code>textplot_terms()</code>. If you pass a dictionary to be highlighted, words are plotted in different colors. <code>data_dictionary_LSD2015</code> is a widely-used sentiment dictionary. If <code>highlighted = NULL</code>, words are selected randomly to highlight.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb121"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb121-1"><a href="#cb121-1" aria-hidden="true" tabindex="-1"></a><span class="fu">textplot_terms</span>(lss, <span class="at">highlighted =</span> data_dictionary_LSD2015[<span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-63-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>Based on the fitted model, we can now predict polarity scores of documents using <code>predict()</code>. It is best to work with the document-level data frame, which we will then add a new column for the predicted polarity scores.</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb122"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb122-1"><a href="#cb122-1" aria-hidden="true" tabindex="-1"></a>dat <span class="ot">&lt;-</span> <span class="fu">docvars</span>(lss<span class="sc">$</span>data)</span>
<span id="cb122-2"><a href="#cb122-2" aria-hidden="true" tabindex="-1"></a>dat<span class="sc">$</span>lss <span class="ot">&lt;-</span> <span class="fu">predict</span>(lss)</span>
<span id="cb122-3"><a href="#cb122-3" aria-hidden="true" tabindex="-1"></a><span class="fu">glimpse</span>(dat)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>Rows: 8,063
Columns: 5
$ head &lt;chr&gt; "Biden: US Desires Diplomacy But 'Ready No Matter What Happens' I…
$ url  &lt;chr&gt; "https://sputniknews.com/20220131/biden-us-desires-diplomacy-but-…
$ time &lt;dttm&gt; 2022-02-01 03:25:22, 2022-02-01 01:58:19, 2022-02-01 01:47:56, 2…
$ date &lt;date&gt; 2022-01-31, 2022-01-31, 2022-01-31, 2022-01-31, 2022-01-31, 2022…
$ lss  &lt;dbl&gt; 0.10093989, 0.99263241, -0.76609160, 0.15991318, 0.25420329, -1.5…</code></pre>
</div>
</div>
<p>Basically what we have is a data frame, where each row represents a single document (here, a news item from Sputnik with a timestamp). Each document also has a predicted polarity score based on the LSS model. We can visualise this easily using <code>ggplot()</code>. But first, we need to smooth the scores using <code>smooth_lss()</code> (otherwise it is too rough to interpret).</p>
<div class="cell">
<div class="sourceCode cell-code" id="cb124"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb124-1"><a href="#cb124-1" aria-hidden="true" tabindex="-1"></a>dat_smooth <span class="ot">&lt;-</span> <span class="fu">smooth_lss</span>(dat, <span class="at">lss_var =</span> <span class="st">"lss"</span>, <span class="at">date_var =</span> <span class="st">"date"</span>)</span>
<span id="cb124-2"><a href="#cb124-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb124-3"><a href="#cb124-3" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(dat_smooth, <span class="fu">aes</span>(<span class="at">x =</span> date, <span class="at">y =</span> fit)) <span class="sc">+</span> </span>
<span id="cb124-4"><a href="#cb124-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb124-5"><a href="#cb124-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_ribbon</span>(</span>
<span id="cb124-6"><a href="#cb124-6" aria-hidden="true" tabindex="-1"></a>    <span class="fu">aes</span>(<span class="at">ymin =</span> fit <span class="sc">-</span> se.fit <span class="sc">*</span> <span class="fl">1.96</span>, </span>
<span id="cb124-7"><a href="#cb124-7" aria-hidden="true" tabindex="-1"></a>        <span class="at">ymax =</span> fit <span class="sc">+</span> se.fit <span class="sc">*</span> <span class="fl">1.96</span>), </span>
<span id="cb124-8"><a href="#cb124-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">alpha =</span> <span class="fl">0.1</span></span>
<span id="cb124-9"><a href="#cb124-9" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">+</span></span>
<span id="cb124-10"><a href="#cb124-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="at">xintercept =</span> <span class="fu">as.Date</span>(<span class="st">"2022-02-24"</span>), <span class="at">linetype =</span> <span class="st">"dotted"</span>) <span class="sc">+</span></span>
<span id="cb124-11"><a href="#cb124-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">"months"</span>, <span class="at">date_labels =</span> <span class="st">"%b %Y"</span>, <span class="at">name =</span> <span class="cn">NULL</span>) <span class="sc">+</span></span>
<span id="cb124-12"><a href="#cb124-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">"Sentiment about Ukraine"</span>, <span class="at">x =</span> <span class="st">"Date"</span>, <span class="at">y =</span> <span class="st">"Sentiment"</span>) <span class="sc">+</span></span>
<span id="cb124-13"><a href="#cb124-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_bw</span>() <span class="sc">+</span></span>
<span id="cb124-14"><a href="#cb124-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">axis.text.x =</span> <span class="fu">element_text</span>(<span class="at">angle =</span> <span class="dv">45</span>, <span class="at">hjust =</span> <span class="dv">1</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="3-quanteda_files/figure-html/unnamed-chunk-65-1.png" class="img-fluid figure-img" width="672"></p>
</figure>
</div>
</div>
</div>
<p>The plot shows that the sentiment of the articles about Ukraine became more negative in March but more positive in April. Zero on the Y-axis is the overall mean of the score; the dotted vertical line indicate the beginning of the war.</p>



</section>
</section>

<div id="quarto-appendix" class="default"><section class="quarto-appendix-contents" role="doc-bibliography" id="quarto-bibliography"><h2 class="anchored quarto-appendix-heading">References</h2><div id="refs" class="references csl-bib-body hanging-indent" data-entry-spacing="0" role="list">
<div id="ref-slapin2008scaling" class="csl-entry" role="listitem">
Slapin, Jonathan B., and Sven-Oliver Proksch. 2008. <span>“A <span>Scaling Model</span> for <span>Estimating Time-Series Party Positions</span> from <span>Texts</span>.”</span> <em>American Journal of Political Science</em> 52 (3): 705–22. <a href="https://doi.org/10.1111/j.1540-5907.2008.00338.x">https://doi.org/10.1111/j.1540-5907.2008.00338.x</a>.
</div>
</div></section></div></main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>